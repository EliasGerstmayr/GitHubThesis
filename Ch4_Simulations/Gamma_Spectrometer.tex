\subsection{Gamma-ray Spectrometer}


... need tool to measure MeV

... at keV scale K-edges for filter packs

... at higher energy Compton -> measure spec

... need change in cross section for sensitive measurements

... then pair production and cascades so need more material and length of cascades

.. cross- section flat so mainly measuring dominant response and will need a second measurement

... use stack of crystals and use GEANT/MCNP due to secondaries, 3D effects as side-scatter and cascades

To characterise X-rays we can measure their relative transmission through different materials and based on that infer a spectrum or a spectral range. Due to the abundance of materials with K-edges in the few to tens of keV energy range, the accuracy of the measurements is particularly good in this region.

In the harder X-ray to gamma range, the transmission of radiation equalises and materials gradually become transparent. Instead of using thin materials and measuring their transmission separately, we can attenuate the radiation several times and measure the signal at multiple points in the decay curve.

One method to detect and characterise hard X-rays and gamma rays is using blocks or slabs of scintillating material extending in the propagation direction of the radiation. The response of the material, i.e. how photons or particles deposit energy and how the scintillator reacts, is then modelled using Monte-Carlo codes, e.g. GEANT4 \cite{Agostinelli2003} or MCNP \cite{Goorley2012}, and compared to the response measured. In general, the penetration depth and the energy deposited in the crystals are proportional to the energy of the radiation transmitted. To discriminate the spectrum even further, different materials can be overlaid as the response varies from material to material. This might be more complicated for very high energetic gamma rays as the cross section is almost identical for most materials at the MeV scale.

In contrast to other transmission studies, at photon energies above few MeV the energy deposition and transmission is less linear but involves decays of photons into matter and those cascading back to photons. This means the signal will not follow a simple Beer's law but will require numerical solving and simulation via GEANT4 considering Bethe-Heitler processes etc, to then estimate how long the cascades go on for before falling off.


As seen in FIGURE XX NUMBER the cross section flattens out and most of the produced pairs will due to their exponential energy spectrum lie in lower energies. This means that using a stack like this will give more of an average spectrum and requires an assumed shape as this detector would not be sensitive to smaller changes.


The specific simulation code for GEANT used is strongly based on work by Jason Cole (Imperial College) who in turn benefited from input by Kristjan Poder (formerly Imperial College, now at DESY in Hamburg).

In this case the code was used to simulate the energy deposited in an array of scintillator crystals by individual X-ray photons or in other word to simulate the response of the detector. It was assumed that multi-photon processes and photon-photon interactions would be negligible and hence tracking individual photons through the detector and simply adding the respective detector response would be sufficient.
It was also assumed that the energy deposited within the scintillator crystals is linearly related to the light yield of the scintillator, i.e. the number of fluorescence photons emitted, and independent of the process of energy deposition (REF). Above a certain threshold this appears to be true (REF).
GEANT also only considers single particle interactions, so collective or nonlinear effects are not resolved.

The code was used to simulate the response of various configurations of scintillator crystals and materials used in experiment, and also to simulate the bremsstrahlung spectrum from electrons interacting with slabs of material and the respective response of detectors to this secondary radiation.

\subsubsection{Experimental Setup}

The setup consists of an array of scintillating crystals that measure decay. Emission of light typically in transverse dimension to allow for compact design and direct imaging. Transverse dimension is spatial resolution
Camera imaging ideally straight and direct to maximise the collection efficiency.
Other readout methods are in principle also possible but the stopping power of scintillator crystals is good at high energies. Photodiodes might be affected due to proximity to high radiation.

The crystals are arranged in an array that traces the decay of the radiation in longitudinal direction, the direction the radiation propagates in, and stretches in the transverse axis. The long part of the crystals stretches across one transverse axis, maximising energy deposition and light output at cost of spatial resolution. Assuming a relatively symmetric transverse extent of the source the crystal rows across the second transverse axis provide this information as well. The crystals are separated by light-tight dividers to avoid cross-talk and are enclosed in all but one side from which the scintillation light leaves the crystal. Reflective dividers can increase the light output as well as polishing and coating of crystal surfaces. The material of the crystals, casing and dividers determine the attenuation of the radiation as it propagates through it. Dense and thick materials attenuate radiation faster than light and thin components. This can be used to tune the detector response to the spectral region one is interested in.

In the experiments described in this thesis, three versions of longitudinally extended scintillator stacks were used as gamma spectrometer. In all three cases the scintillator of choice was caesium-iodide doped with thallium (CsI:Tl) due to its high light conversion efficiency. The individual crystal dimensions in all stacks were $5 \times 5 \times 50\,\mathrm{mm}$, which in principle allows moving crystals from one stack to another if necessary. An overview of the properties of the stacks is also provided in Table \ref{Methods:GSpec:Table}.


\begin{figure}
\centering
\includegraphics[width=0.8\columnwidth]{render_closeup_whitebg.png}
\caption{Sketch of a gamma spectrometer setup in an experiment. The gamma rays (green) traverse from the left a vacuum window (orange) and then in air through a lead collimator onto an array of scintillators (yellow) housed in a casing. The stack is predominantly extended in the longitudinal direction but also has one transverse dimension it resolves. A camera directly images the open side of the scintillators. }
\end{figure}

The $5 \times 5\,\mathrm{mm}$ sides of the crystals facing in transverse direction relative to the propagation of the radiation are imaged by CCD cameras, in this case Andor iXon cameras equipped with suitable objectives and bandpass filters to filter out stray light were used. Andor iXon cameras are very sensitive and allow for high gain, but require efficient light shielding to make use of this feature. Ideally the imaging is without significant aberrations and use the chip efficiently normal imaging is favoured as the collection efficiency will be better, also without mirrors is better but better mirror than camera in the beam path.

A sketch of the principal setup is shown in Figure XX. Examples of detector images taken are shown in Figure XX NUMBER.
\vspace{\baselineskip}


\begin{figure}
\centering
\includegraphics[height=0.3\columnwidth]{scintillator.jpg}\includegraphics[height=0.3\columnwidth]{DualAxis_assembly.JPG}
\caption{Photographs of scintillator arrays used in experiments. Left: RAL stack. Right: Dual-axis long stack.}
\end{figure}

In Chapter \ref{Chap:RR15}, a $47 \times 33$ (longitudinal $\times$ transverse) array of crystals in an aluminium casing was used\footnote{Designed and built by Rob Clarke, CLF.} (see Figure XX left). The crystals were separated by $1\,\mathrm{mm}$ thick light-tight aluminium spacers. The array is held together on the sides by 1 mm aluminium plate, on one side solid, on the other 4 mm diameter holes are cut out over the crystal faces to allow the scintillation light to escape. The aluminium spacers and the backplate reflect the light and direct the flow of photons towards the only open side. The front side of the stack that the radiation is first incident on is fortified with a $9\,\mathrm{mm}$ thick steel plate.
\vspace{\baselineskip}

In Chapter \ref{Chap:BW}, the same scintillator array was used, but the thick steel front plate was replaced by a 1 mm layer of plastic (PTFE). In this setup another layer of CsI was used as profile screen which shifts the decay curve in the stack. The replacement of the front plate shifts this back again. A more detailed discussion on this is performed later.
\vspace{\baselineskip}


\begin{figure}
\centering
\includegraphics[angle=-90, width=0.5\columnwidth]{CsI_shotexemp.jpg}
\includegraphics[angle=-90, width=0.5\columnwidth]{dualaxis_example.png}
\caption{Examples of raw response recorded on CsI scintillator arrays. Top: Taken with RAL stack and lead collimator. Bottom: Imaging one side of the dual-axis stack without collimator setup.}
\end{figure}


In Chapter \ref{Chap:linICS}, a different, more elongated array of $10 \times 70$ (transverse $\times$ longitudinal) crystals of same dimensions as before were used\footnote{Proposed by Stuart Mangles (IC), designed and built by Daniel Treverrow (CLF) and Chris Baird (CLF).}. Since the signal measured on these experiments is mostly highly-directional and emitted in a narrow cone, the signal on the previously described stack was concentrated on a few central rows. This is why in this instance the superfluous transverse extent was removed, slimming the detector in the transverse dimension. In turn the stack was extended in the longitudinal, spectrally important dimension and lighter materials are used to slow down the decay and stretch out the signal over more crystals.
The crystals are transversely spaced by black polyethylene `dog-bone' spacers. In longitudinal direction $0.5\,\mathrm{mm}$ of black nylon were used. The front plate of the stack is a $2\,\mathrm{mm}$ thick aluminium plate. The entire stack is held together by an aluminium skeleton, whereas the 4 long sides are covered by transparent plastic sheets. The side of the crystals that is not imaged is covered by reflective aluminium foil. 
Another new feature is the alternating orientation of the crystals: in every other layer the long side of the crystals is aligning either vertically or horizontally. The alternating layers result in an integrated signal in different axes
In Chapter \ref{Chap:linICS} one side of the detector was imaged directly and a long rectangular mirror was placed at 45 degrees next to the other side, reflecting the scintillating light onto the same CCD chip imaging the other side. This way both views are captured on the same camera and the CCD chips are used most efficiently. Due to the elongation of the stack, however, two Andor iXon cameras had to be used, one for the front section (both views) and one for the back (both views). 



\begin{table}
\centering
\begin{tabular}{l|l|l|r|r}
Name & Crystals & Crystal Dimension & Front Plate & Divider\\ \hline \hline
RAL & $47 \times 33$ & $5 \times 5 \times 50$ mm & Steel 9 mm & Al 1 mm\\
RAL & $47 \times 33$ & $5 \times 5 \times 50$ mm & PTFE 1 mm & Al 1 mm\\
Dual & $10 \times 70$ & $5 \times 5 \times 50$ mm & Al 2 mm & Nylon 0.5 mm
\end{tabular}
\caption{Overview of scintillator arrays used in the experiments discussed in this thesis and their properties, namely the array size, divider and fron plate material.}
\label{Methods:GSpec:Table}
\end{table}



\subsubsection{Image Processing}

Might need projective transform or accounting for aberrations, rotation of image. In which case it is best to image normal. This is also better for efficiency of collection. Dark noise.

As a first step the acquired data has to be processed to remove background of various types.

To account for ambient light and gradients in the chip readout one can take a reference dark image at identical light conditions and subtract it from the on-shot data.

A median filter is used to remove individual `hot' pixels or hard hits.

In Chapter \ref{Chap:RR15} the signal was constrained to a narrow central part of the image due to the lead collimator. The part with the signal was masked out and using the image region above and below a smooth background surface was fitted. This was then subtracted from the main image. This accounts for gradients in the chip and the background noise.

In Chapters \ref{Chap:linICS} and \ref{Chap:BW} the signal occupies large parts of the image and such a fitting seemed less suitable. A region at the edge of the image, not containing a crystal, was selected, its pixel content averaged over and subtracted from every pixel on the image.

\EliasComm{Insert figure here of RR15 signal example, removed mask and estimated background surface.}

\subsubsection{Individual Crystal Extraction}


\EliasComm{New plot on individual crystals.}

\begin{figure}
\centering
%\includegraphics[height=0.25\columnwidth]{CsI_CrystalExtrExample.png}\includegraphics[height=0.25\columnwidth]{CsI_CrystalExtrPixExample.png}
%\includegraphics[width=1.0\columnwidth]{DualAxisCrystalExtrExample.png}
%\includegraphics[height=0.25\columnwidth]{CsI_CrystalExtrExample_Int.png}\includegraphics[height=0.25\columnwidth]{CsI_CrystalExtrPixExample_Int.png}
\includegraphics[trim={4.8cm 0 5cm 0}, clip, width=0.8\columnwidth]{CrystalExtract_Example_Full.png}
\includegraphics[trim={4.8cm 0 5cm 0}, clip, width=0.8\columnwidth]{CrystalExtract_Example_Pixelated.png}
\caption{Example CsI array signal. Individual crystal extraction and pixelated detector belows.}
\end{figure}

Even with efficient filling of the field of view, the crystals emitting the interesting signal only occupy a fraction of the total image.
Integrating over the entire image then includes noise of the signal region but a lot of noise from the background regions as well.
To further reduce the impact of noise we select the regions of the individual crystals (see Figure XX for an example) and extract the content of the crystals, and average over it. As a result we can now display the pixellated response of the detector, only using its active parts.
This gives us pixel counts in a crystal versus transverse and longitudinal crystal.
The shape of the decay in longitudinal direction is characteristic for the spectral content, whereas the transverse dimension indicates the angular divergence, hence the width of the crystal determines the spatial resolution.


\subsubsection{Bremsstrahlung background and shielding}

... how to estimate impact? Look at total yield and if the background to signal yield is larger than 1 percent, assume it will affect the fitting?
... Use signal to noise ratio as indicator instead of yield.

Bremsstrahlung is a useful tool to calibrate the detector. However, it can also constitutes a physical noise source on the setups presented.

In the LWFA setups relevant to this work, electrons are accelerated and dispersed using a magnet in a spectrometer setup. While passing through the chamber and also when leaving it, the electrons will interact with a range of solid materials, resulting in showers of bremsstrahlung being produced and partially measured by the gamma detector.

Depending on the radiation that is being measured this might be an underlying source of noise that can skew the spectral measurement.

In Chapter \ref{Chap:BW} the only radiation produced and measured is bremsstrahlung. The electrons are efficiently converted in a high-Z foil. The signal is very bright and the background is much smaller, will not affect fitting procedure.

In Chapter \ref{Chap:RR15} a bright signal of inverse Compton scattering is produced. Since we only selected the brightest signals, the impact of the bremsstrahlung is low.

In Chapter \ref{Chap:linICS} radiation from linear inverse Compton scattering is measured. The signal is bright but the energy is lower than in the previous cases. The bremsstrahlung noise contributes to a skewing of the distribution.

Instead a range of non-collision or other radiation source shots was selected and their experimental response measured. Their total brightness scales linearly with QE2 of the electrons measured. In case of linear ICS the spectrum is unperturbed and can be used. In case of nonlinear ICS the spectrum is perturbed and in case of bremsstrahlung the electrons are hidden, so this procedure does not work. However, the contribution of the background is not significant anyways.

Measured a range of background brems and averaged over normalised spectra. This shape was then taken and scaled according to the linear relationship found in the QE2 fit. The response was then subtracted from the detector response.

Keegan in \cite{Behm2018_Gamma} used example shots and sampled from them to get an idea of the error.

Could try to simulate more carefully with complete setup.

Shielding: in RR15 the electrons were dispersed vertically. Had to shield the top to reduce the noise coming from the top.
In BW the electrons were dispersed downwards and there was shielding.
In linICS the electrons were dispersed sideways so shielded on the sides.

\subsubsection{Detector Calibration using Bremsstrahlung}

We now extracted the pixellated response of the array. The relative brightness is of important to infer a spectrum, but the measured response of the detector deviates from an ideal simulated detector in a few ways, which changes the shape of the response:

The conversion efficiency of the crystals varies from crystal to crystal. This might be due to quality of the crystal, polishing, radiation damage or age.
The light emitted from the stack might also vary due to small changes in the dividers, polishing, position of the crystal and so on.
The relative measured signal is also affected by a varying viewing angle and collection efficiency across the image. 

\begin{figure}
\centering
\includegraphics[trim={3cm 0 15cm 0}, clip, height=0.3\columnwidth]{Screenshot_GEANT4_RALStack.png}\includegraphics[height=0.3\columnwidth]{ScreenshotGEANT_DualAxisStack.png}
\caption{GEANT representation.}
\end{figure}
To be able to compare the simulated response and the experimentally measured response, we have to match both through a suitable calibration.
In order to correct all the different factors using one calibration, we will use a well understood test signal in the right energy range that we will simulate and measure in experiment. By comparing the simulated and measured response we can obtain a correction factor for each crystal.

A well understood mechanism with spectrum covering a decent range is bremsstrahlung from relativistic electrons interacting with solid foils. The overall spectral shape is also only weakly dependent on the spectral shape of the used electron spectrum. 

In experiment electrons are accelerated using LWFA. The electrons are characterised. A foil of known material and thickness is then inserted into the path of the electrons. In the interaction bremsstrahlung is produced and the response of the gamma detector is recorded. 
Depending on the thickness and choice of material the exact procedure changes a bit.

In Chapter \ref{Chap:RR15}, a 9 mm thick piece of lead was used as converter target. Electron energy is efficiently converted into radiation and a bright wide signal that covers the entire detector is produced. However, the electron energy can not be measured on-shot as the electrons are completely stopped. Instead the electron spectra and their fluctuations were characterised beforehand and an average spectrum was chosen as input for the corresponding GEANT simulation. Since the process is only weakly dependent on the spectral shape, this method is reasonable.

In Chapter \ref{Chap:BW}, a bismuth and tungsten was used. Used for calibration thick tungsten for wide signal.
\EliasComm{What did I use for BW? Probably bismuth etc.}

In Chapter \ref{Chap:linICS}, 1.6 mm of PTFE were used as converter, which mainly just scatters the relativistic electrons and affects their spectrum very little, and the electrons can be measured on-shot. GEANT simulations have also confirmed that the impact on the e-beam is negligible. The radiation produced from this converter target is emitted in a narrow cone and covers maybe one row of crystals instead of the entire detector. This might require taking a range of shots to ensure sufficient coverage of all significant rows over the course of the dataset. A calibration of each row is particularly important if the assembled array and the setup is not very homogeneous. 
The exact on-shot electron spectra can then be used in GEANT to obtain a detector response that is more accurate than the one from the average spectrum.

... in GEANT using pencil beam to start with.

The divergent and bright signal is very useful for a homogeneous detector and can also be used for an inhomogeneous detector if the spectrum is homogeneous over the spatial range.

After obtaining the experimental detector response and the response from the related GEANT simulation, we can compare both.
In Figure XX an example of an experimentally measured and a simulation result for one detector row is presented. We see that the simulated response is very smooth in comparison to the response in experiment. This is be due to varying light efficiency of the crystals. 
By dividing the simulated response by the experimentally measured response we obtain a correction factor, $c_{corr}$, for each crystal in the array of $(i,j)$ crystals:

\begin{equation}
c_{corr}(i,j) = \frac{R_{sim}(i,j)}{R_{exp}(i,j)}.
\end{equation}
\begin{figure}
\centering
%\includegraphics[width=.5\columnwidth]{Example_BremsGEANT_ElecInput.png}\includegraphics[width=.5\columnwidth]{Example_GSpecGEANT_GammaSpec.png}
\includegraphics[width=.5\columnwidth]{Example_GSpec_ExpSim.png}\includegraphics[width=.5\columnwidth]{Example_GSpecGEANT_Corr.png}
\caption{Correction factor XXX CHANGE PLOT.}
\end{figure}

This correction factor now accounts for deviations in the efficiency independently of its source (imaging setup, intrinsic crystal efficiency and so on).
To improve the confidence this can also be done for several shots and averaged over it, but bremsstrahlung is very stable.

In Chapter \ref{Chap:RR15} the circular filter holder that was placed in front of the objective was leading to a `vignetting' of the image. Figure 3d in \cite{Behm2018_Gamma} shows the related correction curve which roughly outlines a U-shape to account for the decrease in light due to the vignetting.

... either do least square fit or do fit from the top which then is more likely to give the U-shape in our case as well.

If the detector is moved or the imaging is being changed, the procedure has to be repeated.

For other data shots the `corrected' response, $R_{corr}$, to match it to the ideal response is then the experimental response, $R_{exp}$, times the correction factor for crystal $(i,j)$ of the array:

\begin{equation}
R_{corr}(i,j) = R_{exp}(i,j) c_{corr} (i,j).
\end{equation}

\EliasComm{ADD explanation how to scale data and whether this is important at all.}

\EliasComm{ADD FIGURE of experimental response, simulated response and correction factor.}

\EliasComm{ADD FIGURE of simulated spectrum and that it is relatively insensitive (and so then the response) for smaller fluctuations, i.e. Jason's/Keegan's method is also valid.}

%\includegraphics[angle=-90, totalheight=0.5\columnwidth]{ScreenshotGEANT_DualAxis_Side.png}



\subsubsection{Detector response for gamma-ray spectra}


... GEANT is important because of cascades but also 3D effects from side-scattering, geometric effects

Since we now have a background-subtracted detector response and we determined a method to account for deviations from an idealised detector, we can now consider fitting a spectrum.

To make this method very generalised, we will devise a method that works for different types of radiation sources with a different spectral shape.

We will run the simulations similarly as before for the bremsstrahlung calibration, but now for mono-energetic gamma rays covering few to hundreds of MeV. The change in response in terms of energy deposition per longitudinal crystal row can be seen in Figure XX for up to 500 MeV gamma rays. Whereas for lower X-ray energies we expect an exponential decay in materials following Beer`s law, the detector response outlines a peak followed by a decay, moving further into the stack with higher energies. This is due to radiation cascading into showers of particles which then deposit energy. The position of this peak is hence an indicator of the length of this cascading and the energy of the radiation. It can be shifted by using lighter materials as dividers, placing additional material in front of the stack and adjusting the front plate.
Figure XX shows the position of the peak energy deposition for different energies for a few geometries varying the separation material and the front plate or profile screen. By adding more materials before the stack, we shift the peak to earlier crystals as we trigger cascades earlier. By using less dense materials we delay the peak to later crystals or are able to stretch out the signal over a wider range.

\begin{figure}
\centering
\includegraphics[width=.5\columnwidth]{EdepGEANTStack.png}\includegraphics[width=.5\columnwidth]{EdepMax_Cases.pdf}
\caption{Simulation results: energy deposited per photon in an extended stack, mono-energetic.}
\end{figure}

\EliasComm{For which detector? Use the fire range.}


\EliasComm{Maybe compare lower energies with higher energies to show the shape changes.}

\EliasComm{Change peak determination by smoothing out or so? Make the plot look less spiky.}


We now have a simulated energy deposition for a range of incoming photon energies in terms of energy deposition for crystals in longitudinal direction for a given photon energy. We assume this is linearly converted into light output and that the output has been corrected/matched to simulations as described previously. For each photon energy $E_i$ we get a array of deposited energies $\mathbf{R_i}$ in the longitudinal crystal columns $C_1$ to $C_n$ 

\begin{eqnarray}
\mathbf{R_i} = & \bordermatrix{\text{}&C_1&C_2&\ldots &C_n\cr
                E_i&R_{i1} &  R_{i2}  & \ldots & R_{in}} 
\end{eqnarray}

where $R_{ij}$ is the energy deposited in crystal $j$ by a photon of energy $E_i$.

If we read this as a matrix of energies in one direction and energy deposition in a particular longitudinal row, we can interpolate this grid onto a finer grid, filling in energies between the simulated photon energies. The energy deposition is normalised such that it represents the energy deposited by one single photon. If we have done this for $m$ different photon energies for a longitudinal array of $n$ crystals, we obtain an $m \times n$ matrix $\mathbf{R}$:

\begin{eqnarray}
\mathbf{R} = & \bordermatrix{\text{}&C_1&C_2&\ldots &C_n\cr
                E_1&R_{11} &  R_{12}  & \ldots & R_{1n}\cr
                E_2& R_{21}  &  R_{22} & \ldots & R_{2n}\cr
                \vdots & \vdots & \vdots & \ddots & \vdots\cr
                E_m & R_{m1}  &   R_{m2}       &\ldots & R_{mn}} 
\end{eqnarray}

An entry $R_{ij}$ is then the energy a photon of energy $E_i$ deposits in crystal $j$.

If we are using this interpolated matrix now to determine the energy deposition, we can for instance select one energy, say 100 MeV photon.
We can also determine the response of one photon at 100 MeV and 1 MeV by adding the respective rows of the matrix.
These operations can also be expressed more generally in terms of a matrix multiplication.

Define a vector $\mathbf{N}$ of length $m$. Each entry be the number of photons or relative weight $N_i$ of energy $E_i$ in an arbitrary gamma spectrum.

\begin{eqnarray}
\mathbf{N} = & \bordermatrix{\text{}&E_1&E_2&\ldots &E_m\cr
               &N_{1} &  N_{2}  & \ldots & N_{m}} 
\end{eqnarray}

Then multiplying the vector $\mathbf{N}$ containing the spectral information of the gamma spectrum with the response matrix $\mathbf{R}$ is equivalent to a combined response and proportional to the signal $\mathbf{S}$, vector of length of the number of crystals $n$, of all photons in the spectrum defined by $\mathbf{N}$.

\begin{eqnarray}
\mathbf{S}=\mathbf{N} \mathbf{R} =  \bordermatrix{\text{}&E_1&\ldots &E_m\cr
               &N_{1}  & \ldots & N_{m}} & \bordermatrix{\text{}&C_1&\ldots &C_n\cr
                &R_{11}  & \ldots & R_{1n}\cr
               & R_{21}   & \ldots & R_{2n}\cr
               & \vdots  & \ddots & \vdots\cr
                 & R_{m1}       &\ldots & R_{mn}} =\bordermatrix{\text{}&C_1&\ldots &C_n\cr
               &S_{1}   & \ldots & S_{n}} 
\end{eqnarray}

Each entry of $\mathbf{S}$ be then

\begin{equation}
S_i = \sum_{j=1}^{m} R_{ij} N_j,
\end{equation}

so the sum of responses for crystal $i$ for all energies weighted by the spectrum $\mathbf{N}$.

Using this matrix multiplication and provided the grid is extensive and fine enough, any sort of spectral shape with relative weighting can be used to determine the response of the detector.

Since this is a matrix operation, in theory one can invert the experimental result to extract the spectrum. Unfortunately, this is an ill posed problem due to the noise and the low sensitivity to smaller changes in the spectral shape makes this impossible by itself. We can assume a spectral shape, calculate the response for a range of parameters and find the best fit, for instance using a least-square fit. If we have another measurement of the spectrum, for instance using pair production, we can further constrain the spectral response (REF).

\begin{figure}
\centering
\includegraphics[width=.5\columnwidth]{GSpecFit_Example2D.png}
\caption{Placeholder: XX FIGURE 2D PLOT AND FITTING. ADD 1D PLOT AND ADD AXES. USE LOGARITHMIC AXIS FOR C}
\end{figure}


In Figure XX we see for example the photon distribution of an exponential spectrum which also describes the high-energy tail end of a synchrotron spectrum (for instance applicable to Chapter \ref{Chap:RR15}. The simulated detector response is given, along with a well suited mono-energetic response which indicates the similarity of spectra despite originating from very different sources.

In Figure XX we see how this simulated response is fitted to experimental data and a 2D least-square fit aimed at finding the best match by varying the amplitude and critical energy of the spectrum.



\subsubsection{Resolving spatial features}

In the transverse direction the detector indicates the divergence of the beam. For a symmetric source either transverse direction is equivalent and by using a stack that always integrates signal in the same transverse axis is sufficient.

One example of a fairly symmetric signal is shown in Figure XX. On the left is a CsI profile screen that shows the profile of the radiation, on the right the uncorrected response of the dual axis scintillator array in both axes. The spatial resolution of the stack is relatively poor, so we can only say it covers 1-2 rows of crystals, on both sides.

Pointing of the source in the vertical will move it in the horizontally integrated axis and vice versa. However, the profile screen has a much better resolution and is better suited for this.

\begin{figure}
\centering
\includegraphics[height=0.2\columnwidth]{ICS_ProfileExample.png}\includegraphics[height=0.2\columnwidth]{ICS_SpecExample.png}

\includegraphics[height=0.2\columnwidth]{Betamax_ProfileExample.png}\includegraphics[height=0.2\columnwidth]{Betamax_SpecExample.png}
\caption{Dual axis images.}
\end{figure}



If we have an asymmetric source that is elongated in one direction, the two views will reflect this as well. In Figure XX we see the elongated signal on the profile screen that is stretched in the horizontal. This was produced by a particularly bright burst of hard betatron radiation. The view integrating vertically shows the broad signal in the first rows. The view integrating along the horizontal axis sees a much more localised signal peak in one row as most of the energy is deposited by one crystal. 

The spatial resolution of the profile screen is better but this enables a spectral analysis of different parts of the beams separately, and tracking the ellipticity of the decay. This is not further investigated in this context, but this a proof-of-principle that this detector is able to resolve the different dimensions and that the spectral retrieval can be done independently. 

Previous results indicate that the ellipticity of the source can be used in ICS experiments to infer the intensity at the interaction in a model-independent way (REF BLACKBURN, UMSTADTER). Further studies indicate that the spectral distribution across the profile, on the other hand, is another observable that could help discriminating models of radiation reaction. This detector could be used for such a measurement in the future.


... Field of View
... spatial resolution is size crystal plus spacing to some extent over distance.